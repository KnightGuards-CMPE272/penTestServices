from flask import Flask
import subprocess
import platform
server = Flask(__name__)

@server.route("/ping/<host>")
def ping(host):
    #windows ping is ping -n 1 while POSIX is ping -c
    param = '-n' if platform.system().lower()=='windows' else '-c'
    # Building the command. Ex: "ping -c 1 google.com"
    command = ['ping', param, '1', host]
    ret = ""
    if subprocess.call(command) == 0:
        ret = "Host is Pingable"
        pass
    else:
        ret = "Host is not Pingable"
        pass
    return ret

@server.route("/cmd_ls")
def nmap():
   process = subprocess.Popen(['ls', '-l'], 
                           stdout=subprocess.PIPE,
                           universal_newlines=True)   
   while True:
      output = process.stdout.readline()
      print(output.strip())
      finaloutput = output +"<br>"
      # Do something else
      return_code = process.poll()
      if return_code is not None:
         print('RETURN CODE', return_code)
         # Process has finished, read rest of the output 
         for output in process.stdout.readlines():
               finaloutput = finaloutput + output.strip() +"<br>"
      return finaloutput


@server.route("/cmd_pwd")
def pwd():
    process = subprocess.Popen(['pwd'], 
                           stdout=subprocess.PIPE,
                           universal_newlines=True)  
    while True:
      output = process.stdout.readline()
      print(output.strip())
      finaloutput = output
      return_code = process.poll()
      if return_code is not None:
         print('RETURN CODE', return_code)
         # Process has finished, read rest of the output 
         for output in process.stdout.readlines():
               finaloutput = finaloutput + output.strip() +"\n"
      return finaloutput



@server.route("/")
def hello():
   return "Hello World!"

if __name__ == "__main__":
   server.run(host='0.0.0.0', port=4999, debug=True)
