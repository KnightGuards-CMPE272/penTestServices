from flask import Flask
import subprocess
server = Flask(__name__)

@server.route("/cmd_ls")
def nmap():
   process = subprocess.Popen(['ls', '-l'], 
                           stdout=subprocess.PIPE,
                           universal_newlines=True)   
   while True:
      output = process.stdout.readline()
      print(output.strip())
      finaloutput = output +"<br>"
      # Do something else
      return_code = process.poll()
      if return_code is not None:
         print('RETURN CODE', return_code)
         # Process has finished, read rest of the output 
         for output in process.stdout.readlines():
               finaloutput = finaloutput + output.strip() +"<br>"
      return finaloutput


@server.route("/cmd_pwd")
def pwd():
    process = subprocess.Popen(['pwd'], 
                           stdout=subprocess.PIPE,
                           universal_newlines=True)  
    while True:
      output = process.stdout.readline()
      print(output.strip())
      finaloutput = output
      return_code = process.poll()
      if return_code is not None:
         print('RETURN CODE', return_code)
         # Process has finished, read rest of the output 
         for output in process.stdout.readlines():
               finaloutput = finaloutput + output.strip() +"\n"
      return finaloutput



@server.route("/")
def hello():
   return "Hello World!"

if __name__ == "__main__":
   server.run(host='0.0.0.0', port=4999, debug=True)