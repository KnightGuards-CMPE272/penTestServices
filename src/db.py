import pymongo
from bson.objectid import ObjectId

mongoClient = pymongo.MongoClient("mongodb://localhost:27017/")
   
def storeScanResult(scanResult):
    pentestDB = mongoClient["pentesterdb"]
    scanResults = pentestDB["scanResults"]
    print(mongoClient.list_database_names())
    print(pentestDB.list_collection_names())
    dboutput = scanResults.insert_one(scanResult)
    print(str(dboutput))
    return dboutput
    
def getScanResult(limit):
    pentestDB = mongoClient["pentesterdb"]
    scanResults = pentestDB["scanResults"]
    print(mongoClient.list_database_names())
    print(pentestDB.list_collection_names())
    dboutput = scanResults.find({},{ "_id": 1, "hostname": 1, "scannedResult":1, "scannedDate": 1 }).sort([("scannedDate",pymongo.DESCENDING)]).limit(int(limit))
    print(str(dboutput))
    return dboutput

def getSingleScanResult(id):
    pentestDB = mongoClient["pentesterdb"]
    scanResults = pentestDB["scanResults"]
    print(mongoClient.list_database_names())
    print(pentestDB.list_collection_names())
    dboutput = scanResults.find_one({"_id":ObjectId(id)},{ "_id": 1, "hostname": 1, "scannedResult":1, "scannedDate": 1 })
    print(str(dboutput))
    return dboutput
    
